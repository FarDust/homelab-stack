api:
  insecure: true
  dashboard: true
experimental:
  plugins:
    sablier:
      moduleName: "github.com/sablierapp/sablier"
      version: "v1.8.5"
http:
  routers:
    dashboard-http:
      entrypoints: web
      rule: Host(`dashboard.${LOCAL_DOMAIN}`) && (PathPrefix(`/api`) || PathPrefix(`/dashboard`) || PathPrefix(`/`))
      service: api@internal
      middlewares:
        - dashboard-https
    dashboard:
      entrypoints: websecure
      rule: Host(`dashboard.${LOCAL_DOMAIN}`) && (PathPrefix(`/api`) || PathPrefix(`/dashboard`) || PathPrefix(`/`))
      middlewares:
        - dashboard-redirect
        - dashboard-strip-prefix
      service: api@internal
      tls:
        certresolver: le-dns
  middlewares:
    dashboard-https:
      redirectscheme:
        scheme: https
    dashboard-redirect:
      redirectregex:
        regex: ^(https:\/\/(\[[\w:.]+\]|[\w\._-]+)(:\d+)?)\/$
        replacement: ${1}/dashboard/
    dashboard-strip-prefix:
      stripPrefix:
        prefixes:
          - /dashboard
          - /dashboard/
    load-manager:
      plugin:
        sablier:
          sablierUrl: http://sablier:10000
          sessionDuration: 1m
          group: default

          # Dynamic strategy, provides the waiting webui
          dynamic:
            displayName: Sablier - Load Manager
            showDetails: true
            theme: shuffle
            refreshFrequency: 5s
    load-maintenance:
      plugin:
        sablier:
          sablierUrl: http://sablier:10000
          sessionDuration: 10m
          group: maintenance
          dynamic:
            displayName: Mantenimiento üõ†Ô∏è
            showDetails: true
            theme: hacker-terminal
            refreshFrequency: 10s
